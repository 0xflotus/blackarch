# This file is part of BlackArch Linux ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=stegoveritas
_pkgname=stegoVeritas
pkgver=1.7
pkgrel=1
pkgdesc='Automatic image steganography analysis tool.'
arch=('any')
groups=('blackarch' 'blackarch-stego')
url='https://github.com/bannsec/stegoVeritas/'
license=('MIT')
depends=('python' 'perl-image-exiftool' 'p7zip' 'foremost' 'steghide' 'exempi')
makedepends=('python-setuptools' 'python-pip')
source=("https://github.com/bannsec/stegoVeritas/archive/$pkgver.tar.gz"
        'requirements.txt')
sha512sums=('25091223f8cfdc329d5b42b3a23da942d86cc9699b9683746a37f4338e17bcccabe588922f85fefd4c4ebd1778715dafd40f58b42e2a4f2db30833ea6a5d6646'
            'cd163a1d274d15c6f8280d62f4bd3c80d0f2392c60b346cd300a579a3b0b25b15ea2570086b279ce2ca7fe4f5044044c3ed05c1d4823adaae6667763cd4283a3')
install="$pkgname.install"

prepare() {
  cp requirements.txt "$_pkgname-$pkgver"
}

package() {
  cd "$_pkgname-$pkgver"

  install -dm 755 "$pkgdir/usr/bin"

  install -Dm 644 requirements.txt "$pkgdir/usr/share/$pkgname/requirements.txt"
  install -Dm 644 LICENSE.md "$pkgname/usr/share/licenses/$pkgname/LICENSE"
  install -Dm 644 -t "$pkgdir/usr/share/doc/$pkgname/" README.md
  rm *.md

  cp -a stegoveritas/ "$pkgdir/usr/share/$pkgname/"

  cat > "$pkgdir/usr/bin/$pkgname" << EOF
#!/usr/bin/env bash
source /usr/share/$pkgname/venv/bin/activate
exec python /usr/share/$pkgname/$pkgname/$pkgname.py "\$@"
EOF

  chmod +x "$pkgdir/usr/bin/$pkgname"
}

